<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Paranormal - Agustín Bola Mortimer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <meta property="og:title" content="Mapa de Investigación Paranormal" />
  <meta property="og:description" content="Explora los puntos más paranormales detectados en mis investigaciones. Agustín Bola Mortimer." />
  <meta property="og:image" content="https://mapaparanormal.netlify.app/terrifie.jpg" />
  <meta property="og:url" content="https://mapaparanormal.netlify.app" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="es_ES" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta property="og:see_also" content="https://www.tiktok.com/@agustinbolamortimer666" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

  <style>
    :root {
      --primary-color: #ff4d4d;
      --bg-dark: #0a0a0a;
      --panel-bg: rgba(20, 20, 20, 0.95);
    }

    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-dark);
      color: white;
    }

    #map { height: 70vh; width: 100%; }

    /* Estilos SEO y Blog */
    .seo-section {
      padding: 40px 20px;
      max-width: 900px;
      margin: auto;
      line-height: 1.6;
    }
    .seo-section h1, .seo-section h2 { color: var(--primary-color); }

    /* Buscador */
    #search-container {
      position: absolute; top: 10px; left: 50%;
      transform: translateX(-50%); z-index: 1000;
      width: 90%; max-width: 400px;
    }
    #search-input {
      width: 100%; padding: 12px; border-radius: 25px;
      border: 1px solid #444; background: var(--panel-bg);
      color: white; font-size: 16px; outline: none;
    }
    #search-results {
      background: var(--panel-bg); border-radius: 10px;
      margin-top: 5px; max-height: 200px; overflow-y: auto; display: none;
    }
    .search-item {
      padding: 10px; border-bottom: 1px solid #333; cursor: pointer;
    }
    .search-item:hover { background: #333; }

    /* Popups Estilo */
    .popup-content h2 {
      margin: 0 0 10px 0; font-size: 1.2rem; color: #cc0000;
    }
    .popup-content p { font-size: 0.95rem; color: #333; }
    .video-container { margin-top: 10px; width: 100%; }
    
    /* Responsive */
    @media (max-width: 600px) {
      #map { height: 60vh; }
    }
  </style>
</head>
<body>

  <div id="search-container">
    <input type="text" id="search-input" placeholder="Buscar lugar paranormal..." />
    <div id="search-results"></div>
  </div>

  <div id="map"></div>

  <section class="seo-section">
    <h1>Mapa de Investigaciones Paranormales de Agustín Bola Mortimer</h1>
    <p>Bienvenido al registro oficial de <strong>fenómenos paranormales</strong> y avistamientos documentados. En este mapa interactivo, podrás explorar de forma gratuita los lugares con mayor actividad de España y otros puntos del mundo.</p>
    
    <h2>¿Qué encontrarás en este mapa de misterio?</h2>
    <p>Cada marcador representa una investigación exhaustiva. Desde <strong>psicofonías</strong> en hospitales abandonados hasta apariciones en castillos y avistamientos <strong>OVNI</strong>. Agustín Bola Mortimer documenta cada caso con descripciones detalladas y material multimedia.</p>

    <h2>Principales puntos de investigación</h2>
    <p>Explora lugares emblemáticos como el Palacio de San Telmo en Sevilla, el misterioso Poblado de Sancti Petri o el Centro de Salud San Luis. Si buscas "lugares encantados cerca de mí", este mapa es la herramienta definitiva para los amantes de lo oculto.</p>
  </section>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

  <script>
    const map = L.map('map').setView([37.38, -5.98], 6);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const paranormalIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/1235/1235121.png',
      iconSize: [40, 40],
      iconAnchor: [20, 40],
      popupAnchor: [0, -40]
    });

    let allData = [];

    function crearPopup(h) {
      // Cambio de título dinámico para la pestaña
      document.title = h.name + " - Investigación Paranormal";
      
      let videoHtml = h.video ? `<div class="video-container"><iframe width="100%" height="150" src="${h.video.replace('watch?v=', 'embed/')}" frameborder="0" allowfullscreen></iframe></div>` : "";
      
      return `
        <div class="popup-content">
          <h2>${h.name}</h2>
          <p>${h.description}</p>
          ${videoHtml}
        </div>
      `;
    }

    function cleanText(t) {
      return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    fetch('hotspots.json')
      .then(res => res.json())
      .then(data => {
        allData = data;
        const markers = L.markerClusterGroup();

        data.forEach(h => {
          if (h.lat && h.lng) {
            const m = L.marker([h.lat, h.lng], { icon: paranormalIcon })
                     .bindPopup(crearPopup(h));
            markers.addLayer(m);
          }
        });
        map.addLayer(markers);
      });

    // Buscador interactivo
    const input = document.getElementById('search-input');
    const resDiv = document.getElementById('search-results');

    input.addEventListener('input', (e) => {
      const val = cleanText(e.target.value);
      resDiv.innerHTML = "";
      if (val.length < 2) { resDiv.style.display = "none"; return; }

      const filtered = allData.filter(h => cleanText(h.name).includes(val));
      filtered.forEach(h => {
        const item = document.createElement('div');
        item.className = 'search-item';
        item.innerHTML = h.name;
        item.onclick = () => {
          map.flyTo([h.lat, h.lng], 16);
          resDiv.style.display = "none";
          input.value = h.name;
        };
        resDiv.appendChild(item);
      });
      resDiv.style.display = "block";
    });
  </script>
</body>
</html>
