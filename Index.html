<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa de Lugares Malditos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tus estilos existentes -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Overlay de inicio -->
  <style>
    #startup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1.5rem;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      font-size: 1.2rem;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease;
    }
    #startup-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
    #startup-overlay span {
      display: block;
      max-width: 480px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <!-- CONTENIDO ORIGINAL DE TU APP -->
  <div id="app">
    <!-- AquÃ­ va todo tu HTML actual: contenedores, mapa, panel lateral, etc. -->
  </div>

  <!-- Overlay de inicio -->
  <div id="startup-overlay" aria-hidden="true">
    <span></span>
  </div>

  <!-- Scripts de tu app (los que ya tuvieras) -->
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha256-nPLb7G8G92Lh0bXnH3UX0rDhmG8I5pIeSue2FY0zMQ8="
    crossorigin=""></script>
  <script src="main.js"></script>

  <!-- Script: contar hotspots y mostrar overlay solo la primera vez -->
  <script>
    (async () => {
      // Solo mostrar la primera vez en este navegador
      if (localStorage.getItem("seenIntroLocations") === "1") return;

      const overlay = document.getElementById("startup-overlay");
      const overlayText = overlay.querySelector("span");

      try {
        const res = await fetch("hotspots.json", { cache: "no-store" });
        if (!res.ok) throw new Error("No se pudo cargar hotspots.json");
        const data = await res.json();

        let count = 0;
        if (Array.isArray(data)) {
          count = data.length;
        } else if (data && typeof data === "object") {
          count = Object.keys(data).length;
        }

        overlayText.textContent =
          count > 0
            ? `Actualmente hay ${count} localizaciones malditas en el mapa.`
            : "Cargando localizaciones malditas en el mapa...";

        // Mostrar
        requestAnimationFrame(() => {
          overlay.classList.add("visible");
        });

        // Mantener visible ~1.5s y luego desvanecer
        setTimeout(() => {
          overlay.classList.remove("visible");
          // Eliminar del DOM tras el fade-out
          setTimeout(() => {
            overlay.remove();
          }, 700);
        }, 1500);

        // Marcar como visto
        localStorage.setItem("seenIntroLocations", "1");
      } catch (err) {
        // Si falla la carga, quitar overlay sin molestar al usuario
        console.error("Error al mostrar overlay de inicio:", err);
        overlay.remove();
      }
    })();
  </script>
</body>
</html>
