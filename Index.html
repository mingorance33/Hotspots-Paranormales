<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Hotspots Paranormales</title>

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
    .leaflet-control-layers-expanded {
      background: rgba(0,0,0,0.7);
      color: #fff;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    // Mapa base
    const map = L.map('map').setView([37.5, -4.5], 7);

    // Capa OpenStreetMap
    const osm = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
      }
    );

    // Capa Ortofoto (ejemplo: Esri World Imagery)
    const ortofoto = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/' +
      'World_Imagery/MapServer/tile/{z}/{y}/{x}',
      {
        maxZoom: 19,
        attribution: 'Tiles &copy; Esri'
      }
    );

    // Añadir una por defecto
    osm.addTo(map);

    // Control de capas
    const baseLayers = {
      "OpenStreetMap": osm,
      "Ortofoto": ortofoto
    };
    L.control.layers(baseLayers, null, { collapsed: false }).addTo(map);

    // Función "Cómo llegar desde mi ubicación" usando navegador + Google Maps
    function crearPopup(h) {
      const lat = h.lat;
      const lng = h.lng;
      const nombre = h.name || 'Sin nombre';
      const desc = h.description || '';

      // Enlace Google Maps con solo destino; el navegador pedirá origen actual
      const urlGMaps = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;

      return `
        <b>${nombre}</b><br>
        ${desc}<br><br>
        <a href="${urlGMaps}" target="_blank" rel="noopener">
          Cómo llegar desde mi ubicación
        </a>
      `;
    }

    // Cargar hotspots.json
    fetch('hotspots.json')
      .then(r => r.json())
      .then(data => {
        data.forEach(h => {
          if (typeof h.lat === 'number' && typeof h.lng === 'number') {
            L.marker([h.lat, h.lng])
              .addTo(map)
              .bindPopup(crearPopup(h));
          }
        });
      })
      .catch(err => console.error('Error cargando hotspots.json:', err));
  </script>
</body>
</html>
